<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:SkiaSharp.Extended.UI.Controls;assembly=SkiaSharp.Extended.UI"
             xmlns:views="clr-namespace:SkiaSharpDemo.Views"
             x:Class="SkiaSharpDemo.Demos.LottiePage"
             Title="Lottie">

    <Grid RowDefinitions="*,Auto">

        <controls:SKLottieView x:Name="lottieView"
                               Source="Lottie/dotnetbot.json"
                               Duration="{Binding Duration}"
                               Progress="{Binding Progress}"
                               IsAnimationEnabled="{Binding IsPlaying}"
                               AnimationSpeed="{Binding AnimationSpeed}"
                               RepeatMode="{Binding RepeatMode}"
                               RepeatCount="{Binding RepeatCount}"
                               AnimationFailed="OnAnimationFailed"
                               AnimationLoaded="OnAnimationLoaded"
                               AnimationCompleted="OnAnimationCompleted" />

        <BoxView Color="Green" Opacity="0.5" CornerRadius="12"
                 WidthRequest="25" HeightRequest="24" Margin="24"
                 HorizontalOptions="End" VerticalOptions="Start"
                 IsVisible="{Binding IsComplete, Source={Reference lottieView}}" />

        <VerticalStackLayout Spacing="12" Padding="12" Grid.Row="1">

            <Slider Minimum="0"
                    Maximum="{Binding Duration, Converter={StaticResource TimeSpanToDouble}, ConverterParameter=1}"
                    Value="{Binding Progress, Converter={StaticResource TimeSpanToDouble}}" />

            <Grid ColumnDefinitions="*,*" Margin="0,-12,0,0">
                <Label Grid.Column="0"
                       Text="{Binding Progress, StringFormat='{}{0:mm\\:ss\\.fff}'}" />
                <Label Grid.Column="1" HorizontalOptions="End"
                       Text="{Binding Duration, StringFormat='{}{0:mm\\:ss\\.fff}'}" />
            </Grid>

            <!-- Speed Controls -->
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                <Label Text="Speed:" VerticalOptions="Center" />
                <Slider Grid.Column="1" Minimum="-2" Maximum="2" Value="{Binding AnimationSpeed}" />
                <Label Grid.Column="2" Text="{Binding AnimationSpeed, StringFormat='{0:F1}x'}" WidthRequest="40" />
            </Grid>
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="6">
                <Button Text="-1x" Command="{Binding SetSpeedCommand}" CommandParameter="-1" />
                <Button Text="0.5x" Command="{Binding SetSpeedCommand}" CommandParameter="0.5" />
                <Button Text="1x" Command="{Binding SetSpeedCommand}" CommandParameter="1" />
                <Button Text="2x" Command="{Binding SetSpeedCommand}" CommandParameter="2" />
            </HorizontalStackLayout>

            <!-- Repeat Controls -->
            <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="12">
                <Label Text="Repeat:" VerticalOptions="Center" />
                <Picker Grid.Column="1" SelectedItem="{Binding RepeatMode}">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type controls:SKLottieRepeatMode}">
                            <controls:SKLottieRepeatMode>Restart</controls:SKLottieRepeatMode>
                            <controls:SKLottieRepeatMode>Reverse</controls:SKLottieRepeatMode>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>
                <Label Grid.Column="2" Text="Count:" VerticalOptions="Center" />
                <Entry Grid.Column="3" Text="{Binding RepeatCount}" Keyboard="Numeric" WidthRequest="60" />
            </Grid>

            <HorizontalStackLayout HorizontalOptions="Center" Spacing="6">
                <Button Text="Reset" Command="{Binding ResetCommand}" />
                <Button Text="-100ms" Command="{Binding StepCommand}" CommandParameter="-100" />
                <Button Text="Play/Pause" Command="{Binding PlayPauseCommand}" />
                <Button Text="+100ms" Command="{Binding StepCommand}" CommandParameter="100" />
                <Button Text="End" Command="{Binding EndCommand}" />
            </HorizontalStackLayout>

        </VerticalStackLayout>
    </Grid>

</ContentPage>